<!doctype html>

<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Vimeo download helper</title>
	<meta name="description" content="">
	<meta name="author" content="">

	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<!-- <script src="/js/main.js"></script> -->
</head>

<body onload="Poll()"> 
<!--		<svg class="bd-placeholder-img mr-2 rounded" width="16" height="16" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><rect width="100%" height="100%" fill="yellow"/></svg>-->

	<nav class="navbar navbar-expand-lg static-top navbar-dark bg-dark">
		<h5 class="mb-0 text-white ">Vimeo download helper</h5>
	</nav>

	<div class="container">
		<legend>New download</legend>
		<form class="needs-validation">
			<div class="row">
				<div class="col-md-3 mb-3">
					<label for="name">Name</label>
					<input type="text" class="form-control" id="name" placeholder="Name" value="" required>
					<div class="invalid-feedback">
						Valid name is required.
					</div>
				</div>
				<div class="col-md-9 mb-3">
					<label for="link">Link</label>
					<input type="text" class="form-control" id="link" placeholder="Link" value="" required>
					<div class="invalid-feedback">
						Valid link name is required.
					</div>
				</div>
			</div>
			<button type="submit" class="btn btn-primary" onclick="AddJob()">Add job</button>
		</form>

	</div>

	<br>

	<div class="container">
		<legend>Download list</legend>
		<table class="table table-hover">
			<thead>
				<tr>
					<th scope="col" class="col-md-1">Number</th>
					<th scope="col" class="col-md-3">Name</th>
					<th scope="col" class="col-md-2">Status</th>
					<th scope="col" class="col-md-2">Duration</th>
				</tr>
			</thead>
			<tbody id="tbody">
			</tbody>
		</table>
	</div>

</body>
<script>

function AddJob() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
		//alert(this.readyState)
        if (this.readyState == 4 && this.status != 200) {
            alert(this.responseText);
        }
    };

 	var name = document.getElementById("name").value;
	var link = document.getElementById("link").value;

    xhttp.open("POST", "/jobs?name=" + name + "&link=" + link, false);
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send("");
}

function GetJobs() {
	var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
		//alert(this.readyState)
        if (this.readyState == 4 && this.status == 200) {
			fillJobTable(this.responseText)
        }
    };

    xhttp.open("GET", "/jobs", false);
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send("");
}

function GetJobs1() {
	var inpObj = document.getElementById("firstName");
	if (!inpObj.checkValidity()) {
		//document.getElementById("demo").innerHTML = inpObj.validationMessage;
	}
	console.log('asdas');
}

function Poll() {
	GetJobs()
	setTimeout("Poll()", 1000)
}

function fillJobTable(text) {
	var obj = JSON.parse(text); 
	var odd = true
	var s = ""
	for(var n in obj) {
		if (odd) 
			s += '<tr class="table-active">'
		else
			s += '<tr>'
		odd = !odd
		s += '<th scope="row">' + obj[n].id + '</th>'
		s += '<td>' + obj[n].name + '</td>'
		s += '<td>' + getStatus(obj[n].status) + '</td>'
		s += '<td>' + obj[n].duration + '</td>'
		s += '</tr>'
	}
	document.getElementById("tbody").innerHTML = s;
 }

function getStatus(status) {
	switch (status){
		case 0: return "queued";
		case 1: return "in progress";
		case 2: return "done";
		case 3: return "error";
	}
	return ""
}
					
	



</script>
</html>